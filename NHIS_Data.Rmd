---
title: "NHIS Data"
author: "Nicole Dodson & Kieran Yuen"
font-family: Corbel
output:
  github_document:
    toc: true
---
# Setup
```{r setup}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading in NHIS data
```{r Loading in NHIS data}
library(readxl)
student_datav1 <- read_excel("student_datav1.xlsx")
```

# Cleaning Data
```{r Cleaning Data}
library(tidyverse)
NHIS_data <- student_datav1 %>% 
  select(educ_a,
         hisp_a,
         raceallp_a,
         agep_a,
         sex_a,
         marstat_a,
         phstat_a,
         covidtest_a) %>%
  rename(Education = educ_a,
         Hisp = hisp_a,
         Race = raceallp_a,
         Age = agep_a,
         Sex = sex_a,
         Marital_Status = marstat_a,
         Health_Status = phstat_a,
         Covid_Test= covidtest_a) %>%
  
  filter(Covid_Test =="1"| #YestoCovidTest
           Covid_Test == "2") %>% #NotoCovidTest 
  
  mutate(Covid_Test = recode(Covid_Test,
                            '1' = 1,#YestoCovidTest
                            '2' = 0)) %>% #NotoCovidTest 
                              
  mutate(Education = recode(Education,
                            '0' = 1,#nohighschool
                            '1' = 1,#nohighschool
                            '2' = 1,#nohighschool
                            '3' = 2,#highschool
                            '4' = 2,#highschool
                            '5' = 3,#somecollege
                            '6' = 4,#associates
                            '7' = 4,#associates
                            '8' = 5,#bachelors
                            '9' = 6,#masters
                            '10' = 7,#phdprofessional
                            '11' = 7,#phdprofessional
                            '97' = NA_real_,
                            '99' = NA_real_)) %>%
  
  mutate(Hisp = recode(Hisp,
                            '1' = "Hispanic",
                            '2' = "Non_hispanic")) %>% 
  
  mutate(Race = recode(Race,
                            '1' = "White only",
                            '2' = "Black/African American only",
                            '3' = "Asian only",
                            '4' = "AIAN only",
                            '5' = "AIAN and any other group",
                            '6' = "Other single and multiple races",
                            '7' = "Refused",
                            '8' = "Not Ascertained",
                            '9' = "Don't know")) %>%
  
  mutate(Race_Hisp = ifelse(Hisp == 'Non_hispanic' & Race == 'Black/African American only', 
                            'Non-Hispanic Black',
                            ifelse(Hisp == 'Non_hispanic' & Race == 'White only', 
                                   'Non-Hispanic White',
                                   ifelse(Hisp == 'Non_hispanic' & Race == 'AIAN and any other group'|
                                            Hisp == 'Non_hispanic' & Race == 'AIAN only'|
                                            Hisp == 'Non_hispanic' & Race == 'Asian only'|
                                            Hisp == 'Non_hispanic' & Race == 'Other single and multiple races', 
                                          'Other',
                                          'Hispanic')))) %>%
                            
  mutate(Sex = recode(Sex,
                            '1' = "Male",
                            '2' = "Female",
                            '7' = NA_character_,
                            '9' = NA_character_)) %>%
  
  mutate(Marital_Status = recode(Marital_Status,
                            '1' = "Married",
                            '2' = "Married",
                            '3' = "Not Married",
                            '4' = "Not Married",
                            '5' = "Not Married",
                            '6' = "Not Married",
                            '7' = "Not Married",
                            '8' = "Not Married",
                            '9' = "Not Married")) %>%
  
  mutate(Health_Status = recode(Health_Status,
                            '1' = 5,
                            '2' = 4,
                            '3' = 3,
                            '4' = 2,
                            '5' = 1,
                            '7' = NA_real_,
                            '9' = NA_real_,
                            )) %>%
  
  mutate(Age_Group = case_when(
    Age <= 34            ~ "27-34",
    Age > 34 & Age <= 44 ~ "35-44",
    Age > 44 & Age <= 54 ~ "45-54",
    Age > 54 & Age <= 64 ~ "55-64"
    ))   %>%
  
  na.omit()
```



# Changing Data Types for variables
```{r Changing Data Types for variables}
NHIS_data$Education <- as.numeric(NHIS_data$Education)

NHIS_data$Race_Hisp <- as.factor(NHIS_data$Race_Hisp)
NHIS_data$Race_Hisp <- factor(NHIS_data$Race_Hisp,
                              levels = c("Non-Hispanic White",
                                         "Non-Hispanic Black",
                                         "Hispanic",
                                         "Other"))

NHIS_data$Age <- as.numeric(NHIS_data$Age)

NHIS_data$Sex <- as.factor(NHIS_data$Sex)

NHIS_data$Marital_Status <- as.factor(NHIS_data$Marital_Status)

NHIS_data$Health_Status <- as.numeric(NHIS_data$Health_Status)

NHIS_data$Covid_Test <- as.factor(NHIS_data$Covid_Test)

NHIS_data$Age_Group <- as.factor(NHIS_data$Age_Group)
```


# Summary tables to check groupings are accurate
```{r Summary tables to check groupings are accurate}
table(NHIS_data$Education)
table(NHIS_data$Hisp)
table(NHIS_data$Race)
table(NHIS_data$Race_Hisp)
table(NHIS_data$Sex)
table(NHIS_data$Marital_Status)
table(NHIS_data$Health_Status)
table(NHIS_data$Covid_Test)
table(NHIS_data$Age_Group)
```


# Summary Statistics
## Summary Statistics: COVID Test
```{r Summary Statistics: COVID Test}
library(gmodels)

CrossTable(NHIS_data$Education, NHIS_data$Covid_Test, prop.chisq=FALSE, prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Race_Hisp, NHIS_data$Covid_Test, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Sex,NHIS_data$Covid_Test, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Marital_Status,NHIS_data$Covid_Test, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Health_Status,NHIS_data$Covid_Test, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Age_Group,NHIS_data$Covid_Test, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)
```

## Summary Statistics: Health Status
```{r Summary Statistics: Health Status}
library(gmodels)

CrossTable(NHIS_data$Education, NHIS_data$Health_Status, prop.chisq=FALSE, prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Race_Hisp, NHIS_data$Health_Status, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Sex,NHIS_data$Health_Status, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Marital_Status,NHIS_data$Health_Status, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Covid_Test,NHIS_data$Health_Status, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)

CrossTable(NHIS_data$Age_Group,NHIS_data$Health_Status, prop.chisq=FALSE,  prop.t=FALSE, prop.r=TRUE, prop.c=FALSE)
```







# Logistic Regression
## Model #1: Demographic information only
```{r Model #1: Demographic information only}
Model_1 <- glm(Covid_Test ~ Education
               + Age 
               + Sex 
               + Marital_Status
               + Race_Hisp,
               data = NHIS_data,
               family = binomial)

summary(Model_1)

library(questionr)
odds.ratio(Model_1) #This tells us the "Odds Ratios"

# library(oddsratio)
# or_glm(data = NHIS_data, model = Model_1, 
#        incr = list(Education = 1, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 2, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 3, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 4, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 5, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 6, Age = 1))
# or_glm(data = NHIS_data, model = Model_1,
#        incr = list(Education = 7, Age = 1))
```



## Model #2: Demographic + Health Status
```{r Model #2: Demographic + Health Status}
Model_2 <- glm(Covid_Test ~ Education
               + Age 
               + Sex 
               + Marital_Status
               + Race_Hisp
               + Health_Status,
               data = NHIS_data,
               family = binomial)

summary(Model_2)

library(questionr)
odds.ratio(Model_2) #This tells us the "Odds Ratios"

# library(oddsratio)
# or_glm(data = NHIS_data, model = Model_2, 
#        incr = list(Education = 1, Age = 1, Health_Status = 1))
# or_glm(data = NHIS_data, model = Model_2,
#        incr = list(Education = 1, Age = 1, Health_Status = 2))
# or_glm(data = NHIS_data, model = Model_2,
#        incr = list(Education = 1, Age = 1, Health_Status = 3))
# or_glm(data = NHIS_data, model = Model_2,
#        incr = list(Education = 1, Age = 1, Health_Status = 4))
# or_glm(data = NHIS_data, model = Model_2,
#        incr = list(Education = 1, Age = 1, Health_Status = 5))
```



## Model #3: Demographic + Health Status + Interaction of Education & Health Status
```{r Model #3: Demographic + Health Status + Interaction of Education & Health Status}
Model_3 <- glm(Covid_Test ~ Education
               + Age 
               + Sex 
               + Marital_Status
               + Race_Hisp
               + Health_Status
               + Education*Health_Status,
               data = NHIS_data,
               family = binomial)

summary(Model_3)

library(questionr)
odds.ratio(Model_3) #This tells us the "Odds Ratios"
```

# Logistic Regression (with Age Groups)
## Model #1a: Demographic information only (with Age Groups)
```{r Model #1a: Demographic information only (with Age Groups)}
Model_1a <- glm(Covid_Test ~ Education
               + Age_Group
               + Sex 
               + Marital_Status
               + Race_Hisp,
               data = NHIS_data,
               family = binomial)

summary(Model_1a)

library(questionr)
odds.ratio(Model_1a) #This tells us the "Odds Ratios"
```



## Model #2a: Demographic + Health Status (with Age Groups)
```{r Model #2a: Demographic + Health Status (with Age Groups)}
Model_2a <- glm(Covid_Test ~ Education
               + Age_Group 
               + Sex 
               + Marital_Status
               + Race_Hisp
               + Health_Status,
               data = NHIS_data,
               family = binomial)

summary(Model_2a)

library(questionr)
odds.ratio(Model_2a) #This tells us the "Odds Ratios"
```



## Model #3a: Demographic + Health Status + Interaction of Education & Health Status (with Age Groups)
```{r Model #3a: Demographic + Health Status + Interaction of Education & Health Status (with Age Groups)}
Model_3a <- glm(Covid_Test ~ Education
               + Age_Group 
               + Sex 
               + Marital_Status
               + Race_Hisp
               + Health_Status
               + Education*Health_Status,
               data = NHIS_data,
               family = binomial)

summary(Model_3a)

library(questionr)
odds.ratio(Model_3a) #This tells us the "Odds Ratios"
```

# OLS Regression (dep. var. Health Status)
## Model #4: Demographic + Health Status
```{r Model #4: Demographic + Health Status}
Model_4 <- lm(Health_Status ~ as.factor(Education)
               + Age_Group 
               + Sex 
               + Marital_Status
               + Race_Hisp
               + Covid_Test,
               data = NHIS_data)

summary(Model_4)
```













